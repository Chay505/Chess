# Story 1.4: Prisma ORM Setup & Initial Schema

## Status
Draft

## Story
**As a** developer,
**I want** Prisma ORM installed with initial database schema including Student, Resource, and Feedback models,
**so that** I have type-safe database access and schema version control from the start.

## Acceptance Criteria
1. Prisma installed and initialized with PostgreSQL provider
2. Prisma schema defines `Student`, `Resource`, `Feedback` models
3. `Resource` model includes `fileData` as `Bytes` type for BYTEA storage
4. Appropriate indexes defined on foreign keys and frequently queried fields
5. Initial migration created and applied to Railway database
6. Prisma Client generated and importable in TypeScript with full type safety
7. Prisma Studio accessible locally for database inspection (`npx prisma studio`)
8. Database seed script created (optional sample data for development)

## Tasks / Subtasks
- [ ] Install and initialize Prisma (AC: 1)
  - [ ] Run `npm install prisma @prisma/client`
  - [ ] Run `npx prisma init`
  - [ ] Configure PostgreSQL provider in schema.prisma
  - [ ] Update DATABASE_URL in .env
- [ ] Define Student model (AC: 2)
  - [ ] Create Student model with id, email, name, preferredLanguage
  - [ ] Add timestamps (createdAt, updatedAt)
  - [ ] Add unique constraint on email
- [ ] Define Resource model (AC: 2, 3)
  - [ ] Create Resource model with id, filename, mimeType, fileSize
  - [ ] Add fileData field as Bytes type
  - [ ] Add foreign key to Student (studentId)
  - [ ] Add timestamps
- [ ] Define Feedback model (AC: 2)
  - [ ] Create Feedback model with id, content (text)
  - [ ] Add foreign key to Student (studentId)
  - [ ] Add timestamps
- [ ] Add indexes (AC: 4)
  - [ ] Index on Student.email
  - [ ] Index on Resource.studentId
  - [ ] Index on Feedback.studentId
- [ ] Create and apply migration (AC: 5)
  - [ ] Run `npx prisma migrate dev --name init`
  - [ ] Verify migration applied to Railway database
  - [ ] Check migration files created
- [ ] Generate Prisma Client (AC: 6)
  - [ ] Run `npx prisma generate`
  - [ ] Verify type safety in VSCode
  - [ ] Test import in TypeScript file
- [ ] Verify Prisma Studio (AC: 7)
  - [ ] Run `npx prisma studio`
  - [ ] Open in browser and verify all models visible
- [ ] Create seed script (AC: 8)
  - [ ] Create prisma/seed.ts
  - [ ] Add sample Student, Resource, Feedback data
  - [ ] Add seed script to package.json
  - [ ] Test seed execution

## Dev Notes

### Prisma Schema Structure

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id                String     @id @default(cuid())
  email             String     @unique
  name              String
  preferredLanguage String     @default("en") // "en" or "fr"
  clerkUserId       String?    @unique // Reference to Clerk user
  resources         Resource[]
  feedback          Feedback[]
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@index([email])
}

model Resource {
  id        String   @id @default(cuid())
  filename  String
  mimeType  String
  fileSize  Int
  fileData  Bytes    // BYTEA storage for file content (max 50MB)
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([studentId])
}

model Feedback {
  id        String   @id @default(cuid())
  content   String   @db.Text // Rich text/markdown content
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([studentId])
}
```

### File Storage Strategy
- **BYTEA Storage:** Files stored as binary data in PostgreSQL
- **Size Limit:** 50MB per file (enforce in application logic)
- **Large Files:** Recommend YouTube/Vimeo URLs for videos instead of upload

### Prisma Commands Reference
- `npx prisma migrate dev` - Create and apply migrations in development
- `npx prisma generate` - Generate Prisma Client
- `npx prisma studio` - Open database GUI
- `npx prisma db seed` - Run seed script

### Testing
- **Schema Validation:** Run `npx prisma validate`
- **Migration Test:** Verify migration applied successfully to Railway
- **Type Safety:** Import PrismaClient and verify autocomplete works
- **Seed Test:** Run seed script and verify data in Prisma Studio

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story creation | John (PM Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
